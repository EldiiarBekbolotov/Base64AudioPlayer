/*!
 * Base64AudioPlayer  v1
 * Copyright 2024-2025 Eldiiar Bekbolotov
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
*/ function Base64AudioPlayer(t,e){if(e=e||{},!window.AudioContext&&!window.webkitAudioContext)throw Error("Web Audio API is not supported in this browser.");this.audioArray=t||[],this.currentIndex=0,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=256,this.source=null,this.buffer=null,this.isPlaying=!1,this.isPaused=!1,this.startTime=0,this.elapsedTime=0,this.duration=0,this.loopMode=e.loopMode||"none",this.onTimeUpdate=e.onTimeUpdate||null,this.onTrackLoad=e.onTrackLoad||null,this.onTrackEnd=e.onTrackEnd||null,this.loadAudio(this.currentIndex)}Base64AudioPlayer.prototype._convertBase64ToArrayBuffer=function(t){for(var e=t.split(","),i=e[1]?e[1]:t,o=atob(i),r=o.length,s=new Uint8Array(r),n=0;n<r;n++)s[n]=o.charCodeAt(n);return s.buffer},Base64AudioPlayer.prototype.loadAudio=function(t){if(t<0||t>=this.audioArray.length){console.error("Index out of bounds");return}var e=this,i=this._convertBase64ToArrayBuffer(this.audioArray[t]);this.audioContext.decodeAudioData(i,function(i){e.buffer=i,e.duration=i.duration,e.elapsedTime=0,"function"==typeof e.onTrackLoad&&e.onTrackLoad(t,e.duration)},function(t){console.error("Error decoding audio data:",t)})},Base64AudioPlayer.prototype.play=function(){var t=this;if(!this.buffer){console.warn("Audio not loaded yet.");return}if(!this.isPlaying){this.source=this.audioContext.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.analyser),this.analyser.connect(this.audioContext.destination);var e=this.elapsedTime;this.startTime=this.audioContext.currentTime-e,this.source.start(0,e),this.isPlaying=!0,this.isPaused=!1,this.source.onended=function(){t.isPaused||("track"===t.loopMode?t.restartTrack():(t.isPlaying=!1,t.elapsedTime=0,"function"==typeof t.onTrackEnd&&t.onTrackEnd(t.currentIndex),"collection"===t.loopMode&&t.nextTrack(!0)))},"function"==typeof this.onTimeUpdate&&this._startTimeUpdateLoop()}},Base64AudioPlayer.prototype.restartTrack=function(){this.stop(),this.elapsedTime=0,this.play()},Base64AudioPlayer.prototype.pause=function(){this.isPlaying&&(this.source.stop(),this.elapsedTime=this.audioContext.currentTime-this.startTime,this.isPlaying=!1,this.isPaused=!0)},Base64AudioPlayer.prototype.togglePlayPause=function(){this.isPlaying?this.pause():(this.elapsedTime>=this.duration&&(this.elapsedTime=0),this.play())},Base64AudioPlayer.prototype.stop=function(){this.isPlaying&&(this.source.stop(),this.isPlaying=!1,this.isPaused=!1)},Base64AudioPlayer.prototype.nextTrack=function(t){if(t=t||!1,this.currentIndex<this.audioArray.length-1)this.currentIndex++;else if("collection"===this.loopMode)this.currentIndex=0;else{t||console.warn("No more tracks available.");return}this.loadAudio(this.currentIndex),this.elapsedTime=0,(this.isPlaying||t)&&this.play()},Base64AudioPlayer.prototype.prevTrack=function(){this.currentIndex>0?(this.currentIndex--,this.loadAudio(this.currentIndex),this.elapsedTime=0,this.isPlaying&&this.play()):console.warn("This is the first track.")},Base64AudioPlayer.prototype.setLoopMode=function(t){"none"===t||"track"===t||"collection"===t?this.loopMode=t:console.error("Invalid loop mode. Use 'none', 'track', or 'collection'.")},Base64AudioPlayer.prototype.getCurrentTime=function(){return this.isPlaying?this.audioContext.currentTime-this.startTime:this.elapsedTime},Base64AudioPlayer.prototype.getDuration=function(){return this.duration},Base64AudioPlayer.prototype.getCurrentTrackIndex=function(){return this.currentIndex},Base64AudioPlayer.prototype.getTrackCount=function(){return this.audioArray.length},Base64AudioPlayer.prototype._startTimeUpdateLoop=function(){var t=this;!function e(){if(t.isPlaying){var i=t.getCurrentTime();"function"==typeof t.onTimeUpdate&&t.onTimeUpdate(i,t.duration),requestAnimationFrame(e)}}()},window.Base64AudioPlayer=Base64AudioPlayer;